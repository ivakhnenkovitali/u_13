import{d as j,r as g,w as K,c as w,u as t,g as O,s as Y,a as L,b as R,o as r,e as i,F as I,f as T,n as N,h,t as b,p as P,i as A,_ as D,j as Q,k as v,l as G,m as J,q as X,v as Z,x as ee,y as x,z as E,A as te,B as se,C as V}from"./_plugin-vue_export-helper-BPD3Vytu.js";import{w as ae}from"./index-C8oTb3Ol.js";import{o as oe,u as le}from"./index-Dn5URhcg.js";const C=[{keyword:"title",hint:"Lab title (default)"},{keyword:"details",hint:"Lab details"},{keyword:"tag",hint:"Lab tags"},{keyword:"author",hint:"Lab author"}],ne=C[0].keyword;function re(e){const o=t(e);let s,a;if(o.includes(":")){const l=o.split(":");s=l[0].trim(),a=l[1].trim(),C.some(f=>f.keyword===s)||(s="",a=o)}else s="",a=o;return{keyword:s,query:a}}const ce=e=>{if(!e)return"";console.log("text",e);const o=e.replace(/<</g,'<span class="fw-semibold text-primary">').replace(/>>/g,"</span>");return console.log("updatedText",o),o},F=j("platformSearchBox",()=>{const e=g(""),o=g("");K(o,()=>{e.value=""});const s=g([]),a=g(!1),l=g(!1),f=g(!1),p=w(()=>{const n=C.filter(c=>c.keyword.toLowerCase().startsWith(e.value.toLowerCase()));return n.length>0?n:e.value.length>0?[]:C}),m=async()=>{console.log("searching");try{a.value=!0,l.value=!1,f.value=!1;const n=await O(`/api/v1/search/?q=${e.value}&target=${o.value||ne}`);n.data.length==0?(s.value=[],f.value=!0):(console.log(n.data),s.value=n.data.map(c=>({id:c.id,title:c.name,image:c.lab_image_url,description:Y(ce(c.details_headline)),url:window.location.origin+"/blueteam-ctf-challenges/"+c.slug})),console.log(s.value))}catch(n){console.error(n),l.value=!0}finally{a.value=!1}};return ae(e,()=>{s.value=[],e.value.length>=3&&m()},{debounce:400,maxWait:1e3}),K(e,()=>{f.value&&(f.value=!1);const{keyword:n}=re(e);n&&(o.value=n,e.value=e.value.replace(`${n}:`,""))}),{searchQuery:e,searchKeyword:o,searchResult:s,filteredSearchKeywords:p,isLoading:a,isFailed:l,isNoDataFound:f}}),ie=e=>(P("data-v-b2dd0937"),e=e(),A(),e),de=ie(()=>h("li",{class:"list-group-item fs-6 fw-semibold border-bottom-0 pb-0"},"Keywords:",-1)),ue=["id","aria-selected","aria-label","onClick"],he={class:"fw-semibold text-dark search-by__item text-lowercase"},pe=L({__name:"SearchKeywordList",props:{selectedIndex:{}},setup(e){const{filteredSearchKeywords:o,searchKeyword:s}=R(F()),a=l=>{s.value=l};return(l,f)=>(r(),i(I,null,[de,(r(!0),i(I,null,T(t(o),(p,m)=>(r(),i("li",{key:p.keyword,id:`search-panel-item-${m}`,class:N(["list-group-item list-group--tag",{focused:l.selectedIndex===m}]),role:"option","aria-selected":l.selectedIndex===m,"aria-label":`Keyword: ${p.keyword} - Search by ${p.hint}`,tabindex:"0",onClick:n=>a(p.keyword)},[h("strong",he,b(p.keyword)+":",1),h("small",null,b(p.hint),1)],10,ue))),128))],64))}}),_e=D(pe,[["__scopeId","data-v-b2dd0937"]]),fe=e=>(P("data-v-31b4394c"),e=e(),A(),e),me={id:"platform-search-listbox",class:"list-group dropdown-panel py-0",role:"listbox","aria-live":"polite","aria-label":"Search Results Panel"},ye=fe(()=>h("li",{class:"list-group-item fs-6 fw-semibold border-bottom-0 pb-0"},"Search Results:",-1)),ge=["id","onClick","aria-selected","aria-label"],ve=["href"],we={class:"row"},be={class:"col-3"},ke=["src","alt"],Se={class:"col-9 p-0"},xe={class:"d-flex flex-column justify-content-center h-100"},Ie=["textContent"],$e=["innerHTML"],Ke={key:1,class:"list-group-item"},Ce={key:2,class:"list-group-item"},Le={key:3,class:"list-group-item"},De={class:"fw-semibold text-dark"},Be={key:0},Ee=L({__name:"SearchPanel",setup(e){const{searchResult:o,filteredSearchKeywords:s,searchQuery:a,searchKeyword:l,isLoading:f,isFailed:p,isNoDataFound:m}=R(F()),n=w(()=>s.value.length||o.value.length||a.value.length<3),c=w(()=>s.value.length&&!l.value),y=w(()=>o.value.length&&a.value.length>=3),k=w(()=>s.value.length),d=g(-1);K(a,()=>{d.value=-1});const W=_=>{d.value<_-1?d.value++:d.value=0},q=_=>{d.value>0?d.value--:d.value=_-1};oe(["ArrowUp","ArrowDown","Enter"],_=>{if(_.preventDefault(),!n.value)return;const S=o.value.length+s.value.length;if(_.key==="ArrowUp")q(S);else if(_.key==="ArrowDown")W(S);else if(_.key==="Enter"&&d.value>=0){const u=document.getElementById(`search-panel-item-${d.value}`);console.log("Enter key pressed, selectedElement: ",u,d.value),u&&u.click(),d.value=-1}const $=document.getElementById(`search-panel-item-${d.value}`);$&&$.scrollIntoView({block:"end"})});const z=(_,S)=>{_.target instanceof HTMLElement&&_.target.tagName.toLowerCase()!=="a"&&(window.location.href=S)};return(_,S)=>{const $=_e;return r(),i("ul",me,[t(n)?(r(),i(I,{key:0},[t(c)?(r(),Q($,{key:0,"selected-index":t(d)},null,8,["selected-index"])):v("",!0),t(y)?(r(),i(I,{key:1},[ye,(r(!0),i(I,null,T(t(o),(u,B)=>(r(),i("li",{key:u.id,id:`search-panel-item-${t(k)+B}`,class:N(["list-group-item search-result",{focused:t(d)===t(k)+B}]),onClick:U=>z(U,u.url),tabindex:"0",role:"option","aria-selected":t(d)===t(k)+B,"aria-label":`Search Result: ${u.title} - ${u.description}`},[h("a",{href:u.url},[h("div",we,[h("div",be,[h("img",{class:N(["w-100",{"mt-1":u.description}]),src:u.image,alt:u.title,height:"36",decoding:"async"},null,10,ke)]),h("div",Se,[h("div",xe,[h("h5",{class:"m-0",textContent:b(u.title)},null,8,Ie),u.description?(r(),i("p",{key:0,class:"mb-0 text-gray-700 lab-desc",innerHTML:u.description},null,8,$e)):v("",!0)])])])],8,ve)],10,ge))),128))],64)):v("",!0)],64)):t(f)?(r(),i("li",Ke,"Loading...")):t(p)?(r(),i("li",Ce," Failed to fetch search results, please try again. ")):t(m)?(r(),i("li",Le,[G(" No results for "),h("strong",De,b(("truncateString"in _?_.truncateString:t(J))(t(a),13)),1),t(l)?(r(),i("span",Be," in "+b(t(l)),1)):v("",!0)])):v("",!0)])}}}),Ne=D(Ee,[["__scopeId","data-v-31b4394c"]]),Re={class:"d-flex align-items-center"},Fe={for:"search-input",class:"d-flex align-items-center form-control gap-2"},Te=["icon"],Pe={key:0,class:"fw-semibold keyword"},Ae=["placeholder"],Qe=L({__name:"SearchInput",props:{focused:{type:Boolean}},setup(e){const o=e,s=g(null),{searchQuery:a,searchKeyword:l,isLoading:f}=R(F()),p=w(()=>o.focused?"Enter at least 3 characters":"Search..."),m=()=>{a.value||(l.value="")};K(l,()=>{var c;l.value&&((c=s.value)==null||c.focus())});const n=()=>{var c;return(c=s.value)==null?void 0:c.blur()};return(c,y)=>(r(),i("div",Re,[h("label",Fe,[h("iconify-icon",{icon:t(f)?"line-md:loading-loop":"iconamoon:search",class:"accordion fs-4"},null,8,Te),t(l)?(r(),i("span",Pe,b(t(l))+": ",1)):v("",!0),X(h("input",{ref_key:"searchInput",ref:s,"onUpdate:modelValue":y[0]||(y[0]=k=>ee(a)?a.value=k:null),type:"search",placeholder:t(p),id:"search-input",class:"search-input-field","aria-controls":"platform-search-listbox",onKeydown:[x(m,["delete"]),y[1]||(y[1]=x(E(()=>{},["prevent"]),["enter"])),y[2]||(y[2]=x(E(()=>{},["prevent"]),["up"])),y[3]||(y[3]=x(E(()=>{},["prevent"]),["down"]))],onKeyup:x(n,["esc"])},null,40,Ae),[[Z,t(a)]])])]))}}),Ve=D(Qe,[["__scopeId","data-v-0ade1aff"]]),Me=["aria-expanded"],He=L({__name:"SearchComponent",setup(e){const o=g(null),s=g(null),{focused:a}=le(s);return(l,f)=>{const p=Ve,m=Ne;return r(),i("div",{ref_key:"searchComponent",ref:s,class:"position-relative search-component w-100",tabindex:"-1",role:"combobox","aria-label":"Search CyberDefenders BlueYard Labs by title, author, tags, or description","aria-haspopup":"listbox","aria-expanded":t(a),"aria-owns":"platform-search-listbox"},[te(p,{focused:t(a)},null,8,["focused"]),t(a)?(r(),Q(m,{key:0,ref_key:"searchPanel",ref:o},null,512)):v("",!0)],8,Me)}}}),M=D(He,[["__scopeId","data-v-e2387855"]]),H=se();V("searchInput",M,[],H);V("searchInputForCollapsedNav",M,[],H);